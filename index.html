<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>VS Alex - ç¢ºä¿¡ç‰ˆ</title>
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; text-align: center; padding-top: 50px; }
        #alex-box { background: #333; width: 80%; max-width: 500px; margin: 0 auto; padding: 20px; border-radius: 15px; border: 2px solid #555; }
        #alex-text { font-size: 1.2rem; min-height: 50px; margin-bottom: 20px; }
        .mic-btn { width: 80px; height: 80px; border-radius: 50%; border: none; background: #d32f2f; color: white; font-size: 2rem; cursor: pointer; }
        .mic-btn.listening { background: #4caf50; box-shadow: 0 0 20px #4caf50; }
    </style>
</head>
<body>

    <div id="alex-box">
        <div id="alex-text">Talk to me... (ã‚µã‚¤ãƒˆã§å‹•ã„ãŸãªã‚‰ã€ã“ã“ã§ã‚‚å‹•ãã¯ãšã )</div>
        <div id="translation" style="color: #999; font-size: 0.9rem;"></div>
        <button id="mic-btn" class="mic-btn">ğŸ¤</button>
    </div>

    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        // å›ã®ã‚­ãƒ¼
        const API_KEY = "AIzaSyBxOpLgJlbu5_uRTBhZL1gLdv1AjyNgkOI";
        const genAI = new GoogleGenerativeAI(API_KEY);
        // æœ€æ–°ã®å®‰å®šãƒ¢ãƒ‡ãƒ«ã‚’æŒ‡å®š
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

        const micBtn = document.getElementById('mic-btn');
        const alexText = document.getElementById('alex-text');
        const translationDiv = document.getElementById('translation');

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.lang = 'en-US';

        micBtn.onclick = () => {
            recognition.start();
            micBtn.classList.add('listening');
        };

        recognition.onresult = async (event) => {
            micBtn.classList.remove('listening');
            const userText = event.results[0][0].transcript;
            alexText.innerText = "Thinking...";

            try {
                // å…¬å¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦é€ä¿¡
                const prompt = `ã‚ãªãŸã¯å³ã—ã„ä¸Šå¸Alexã§ã™ã€‚çŸ­ãè‹±èªã§è¿”ç­”ã—ã€æœ€å¾Œã«ã€Œæ—¥æœ¬èªè¨³ï¼šã€œã€œã€ã¨ã¤ã‘ã¦ã€‚: ${userText}`;
                const result = await model.generateContent(prompt);
                const response = await result.response;
                const text = response.text();

                const parts = text.split('æ—¥æœ¬èªè¨³ï¼š');
                alexText.innerText = parts[0];
                translationDiv.innerText = parts[1] ? "ï¼ˆ" + parts[1] + "ï¼‰" : "";

                // éŸ³èª­
                const uttr = new SpeechSynthesisUtterance(parts[0]);
                uttr.lang = 'en-US';
                window.speechSynthesis.speak(uttr);

            } catch (e) {
                alexText.innerText = "ã‚¨ãƒ©ãƒ¼: " + e.message;
            }
        };
    </script>
</body>
</html>
