<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>è¨ºæ–­ãƒ¢ãƒ¼ãƒ‰</title>
    <style>
        body { background: #222; color: #fff; font-family: sans-serif; text-align: center; padding: 50px; }
        #status { color: #ffeb3b; margin-bottom: 20px; }
        #error-log { background: #000; color: #ff5252; padding: 20px; border-radius: 10px; margin-top: 20px; font-family: monospace; text-align: left; display: none; }
        button { padding: 15px 30px; font-size: 1.2rem; cursor: pointer; }
    </style>
</head>
<body>

    <h2>Alex æ¥ç¶šãƒ†ã‚¹ãƒˆ</h2>
    <div id="status">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€ŒHelloã€ã¨è©±ã—ã¦ã¿ã¦</div>
    
    <button id="test-btn">ğŸ¤ ãƒ†ã‚¹ãƒˆé–‹å§‹</button>
    
    <div id="error-log" id="log-box">
        <strong>ã€ã‚¨ãƒ©ãƒ¼è©³ç´°ã€‘</strong><br>
        <span id="log-text"></span>
    </div>

<script>
    const API_KEY = 'AIzaSyBxOpLgJlbu5_uRTBhZL1gLdv1AjyNgkOI';

    const btn = document.getElementById('test-btn');
    const status = document.getElementById('status');
    const logBox = document.getElementById('error-log');
    const logText = document.getElementById('log-text');

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition ? new SpeechRecognition() : null;

    if (!recognition) {
        status.innerText = "ãƒ–ãƒ©ã‚¦ã‚¶ãŒéŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ãªã„ã‚ˆã€‚Chromeã§é–‹ã„ã¦ã‚‹ï¼Ÿ";
    }

    btn.onclick = () => {
        recognition.start();
        status.innerText = "èãå–ã‚Šä¸­...";
    };

    recognition.onresult = async (event) => {
        const text = event.results[0][0].transcript;
        status.innerText = "é€šä¿¡ä¸­...";
        
        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: text }] }] })
            });

            const data = await response.json();

            if (response.ok) {
                status.innerText = "âœ… æˆåŠŸï¼Alexã®è¿”ç­”: " + data.candidates[0].content.parts[0].text;
                logBox.style.display = "none";
            } else {
                // ã“ã“ã§ã‚¨ãƒ©ãƒ¼ã®æ­£ä½“ã‚’æš´ã
                status.innerText = "âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ";
                logBox.style.display = "block";
                logText.innerText = JSON.stringify(data.error, null, 2);
            }
        } catch (e) {
            status.innerText = "âŒ æ¥ç¶šè‡ªä½“ã«å¤±æ•—";
            logBox.style.display = "block";
            logText.innerText = e.message;
        }
    };
</script>
</body>
</html>
