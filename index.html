<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VS Alex - è„±ãƒ»Sorryï¼</title>
    <style>
        body { margin: 0; font-family: 'Helvetica Neue', sans-serif; height: 100vh; display: flex; align-items: center; justify-content: center;
               /* ã‚ªãƒ•ã‚£ã‚¹èƒŒæ™¯ã‚’ã‚»ãƒƒãƒˆ */
               background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1497366216548-37526070297c?auto=format&fit=crop&w=1200&q=80');
               background-size: cover; background-position: center; color: white; overflow: hidden; }
        
        #app-container { width: 90%; max-width: 500px; text-align: center; background: rgba(255,255,255,0.1); padding: 40px; border-radius: 30px; backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        #alex-status { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 2px; color: #ff5252; margin-bottom: 10px; }
        
        #alex-message { font-size: 1.6rem; font-weight: bold; margin-bottom: 15px; min-height: 80px; line-height: 1.2; color: #fff; }
        
        #translation { font-size: 1rem; color: #bbb; margin-bottom: 40px; font-style: italic; }
        
        .mic-btn { width: 100px; height: 100px; border-radius: 50%; border: none; background: #d32f2f; color: white; font-size: 2.5rem; cursor: pointer; transition: 0.3s; box-shadow: 0 0 15px rgba(211,47,47,0.4); }
        .mic-btn:hover { transform: scale(1.05); background: #f44336; }
        .mic-btn.listening { background: #4caf50; box-shadow: 0 0 30px #4caf50; animation: pulse 1.5s infinite; }
        
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        
        #user-speech { margin-top: 30px; font-size: 0.9rem; color: #03a9f4; min-height: 20px; }
        .hint { margin-top: 15px; font-size: 0.8rem; color: #ffeb3b; background: rgba(255,235,59,0.1); padding: 5px 10px; border-radius: 5px; display: inline-block; }
    </style>
</head>
<body>

<div id="app-container">
    <div id="alex-status">Boss Alex is watching you</div>
    <div id="alex-message">Talk to me. Now.</div>
    <div id="translation">(è©±ã—ã‹ã‘ã¦ã“ã„ã€ä»Šã™ãã )</div>
    
    <button id="mic-btn" class="mic-btn">ğŸ¤</button>
    <div id="user-speech"></div>
    <div id="hint-area"></div>
</div>

<script>
    // æ–°ã—ã„ã‚­ãƒ¼ã‚’ã‚»ãƒƒãƒˆæ¸ˆã¿
    const API_KEY = 'AIzaSyBxOpLgJlbu5_uRTBhZL1gLdv1AjyNgkOI';

    const micBtn = document.getElementById('mic-btn');
    const alexMessage = document.getElementById('alex-message');
    const translationDiv = document.getElementById('translation');
    const userSpeechDiv = document.getElementById('user-speech');
    const hintArea = document.getElementById('hint-area');

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
        alert("ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚Chromeã‚’ä½¿ã£ã¦ã¿ã¦ã­ï¼");
    }
    const recognition = new SpeechRecognition();
    recognition.lang = 'en-US';

    micBtn.onclick = () => {
        recognition.start();
        micBtn.classList.add('listening');
        userSpeechDiv.innerText = "Listening...";
    };

    recognition.onresult = (event) => {
        micBtn.classList.remove('listening');
        const transcript = event.results[0][0].transcript;
        userSpeechDiv.innerText = "You: " + transcript;
        chatWithAlex(transcript);
    };

    recognition.onerror = () => {
        micBtn.classList.remove('listening');
        userSpeechDiv.innerText = "Error: éŸ³å£°ãŒèãå–ã‚Œãªã‹ã£ãŸã‚ˆã€‚";
    };

    async function chatWithAlex(text) {
        alexMessage.innerText = "...";
        translationDiv.innerText = "";
        
        try {
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: `ã‚ãªãŸã¯å³ã—ã„ä¸Šå¸Alexã§ã™ã€‚
                        ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä»Šã®ç™ºè¨€: "${text}"
                        
                        ã€ãƒ«ãƒ¼ãƒ«ã€‘
                        1. è‹±èªã§1ã€œ2æ–‡ã€å³ã—ãçŸ­ãè¿”ç­”ã€‚
                        2. è¿”ç­”ã®æœ€å¾Œã«å¿…ãšã€Œæ—¥æœ¬èªè¨³ï¼šã€œã€œã€ã¨ã¤ã‘ã¦ãã ã•ã„ã€‚
                        3. æœ€å¾Œã«ã€ŒğŸ’¡ãƒ’ãƒ³ãƒˆï¼šã€œã€œã€ã¨ã„ã†å½¢å¼ã§ã€My bad./Thanks for waiting./Noted./No biggie./Let me check.ã®ã©ã‚Œã‹ã‚’ä½¿ã†ã‚ˆã†ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã—ã¦ã€‚
                        4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ "Sorry" ã‚’ä½¿ã£ãŸã‚‰æ¿€æ€’ã—ã¦ã€‚` }]
                    }]
                })
            });

            const data = await response.json();
            const fullReply = data.candidates[0].content.parts[0].text;
            
            // ãƒ†ã‚­ã‚¹ãƒˆã‚’åˆ†å‰²ã—ã¦è¡¨ç¤º
            const parts = fullReply.split('\n');
            const english = parts[0];
            const translation = parts.find(p => p.includes('æ—¥æœ¬èªè¨³')) || "";
            const hint = parts.find(p => p.includes('ğŸ’¡')) || "";

            alexMessage.innerText = english;
            translationDiv.innerText = translation.replace('æ—¥æœ¬èªè¨³ï¼š', '');
            hintArea.innerHTML = hint ? `<span class="hint">${hint}</span>` : "";

            // ãƒã‚¤ãƒ†ã‚£ãƒ–éŸ³èª­
            const uttr = new SpeechSynthesisUtterance(english);
            uttr.lang = 'en-US';
            uttr.rate = 1.0;
            speechSynthesis.speak(uttr);

        } catch (e) {
            alexMessage.innerText = "Error: ã¾ã ã‚­ãƒ¼ãŒé€šã‚‰ãªã„ã¿ãŸã„ã€‚5åˆ†å¾…ã£ã¦ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã—ã¦ï¼";
        }
    }
</script>

</body>
</html>
