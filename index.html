<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>VS Alex - èµ·å‹•ãƒ•ã‚§ãƒ¼ã‚º</title>
    <style>
        body { background: #1a1a1a; color: white; font-family: sans-serif; text-align: center; padding-top: 50px; }
        #alex-box { background: #2a2a2a; width: 85%; max-width: 500px; margin: 0 auto; padding: 30px; border-radius: 20px; border: 2px solid #444; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        #alex-text { font-size: 1.4rem; font-weight: bold; min-height: 60px; margin-bottom: 10px; color: #fff; }
        #translation { color: #888; font-size: 1rem; margin-bottom: 30px; min-height: 24px; }
        .mic-btn { width: 90px; height: 90px; border-radius: 50%; border: none; background: #e53935; color: white; font-size: 2.2rem; cursor: pointer; transition: 0.3s; }
        .mic-btn.listening { background: #43a047; box-shadow: 0 0 20px #43a047; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        #status { margin-top: 20px; font-size: 0.8rem; color: #666; }
    </style>
</head>
<body>

    <div id="alex-box">
        <div id="alex-text">Ready for you.</div>
        <div id="translation">æº–å‚™ã¯ã„ã„ã‹ã€‚</div>
        <button id="mic-btn" class="mic-btn">ğŸ¤</button>
        <div id="status">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦è‹±èªã§è©±ã›</div>
    </div>

    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai"
        }
      }
    </script>

    <script type="module">
        import { GoogleGenerativeAI } from "@google/generative-ai";

        // å›ãŒæ–°ã—ãä½œã£ãŸæœ€å¼·ã®ã‚­ãƒ¼
        const API_KEY = "AIzaSyBsb4sW9ox5UCFmxRDZDn-A9sjBTvZ1w_I";
        const genAI = new GoogleGenerativeAI(API_KEY);
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

        const micBtn = document.getElementById('mic-btn');
        const alexText = document.getElementById('alex-text');
        const translationDiv = document.getElementById('translation');
        const statusDiv = document.getElementById('status');

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = new SpeechRecognition();
        recognition.lang = 'en-US';

        micBtn.onclick = () => {
            recognition.start();
            micBtn.classList.add('listening');
            statusDiv.innerText = "Listening...";
        };

        recognition.onresult = async (event) => {
            micBtn.classList.remove('listening');
            const userText = event.results[0][0].transcript;
            statusDiv.innerText = "You said: " + userText;
            alexText.innerText = "Thinking...";

            try {
                // Alexã®æ€§æ ¼è¨­å®šã‚’è¾¼ã‚ã¦é€ä¿¡
                const prompt = `ã‚ãªãŸã¯è¶…å³ã—ã„ä¸Šå¸ã®Alexã§ã™ã€‚éƒ¨ä¸‹ã®è‹±èªãŒä¸‹æ‰‹ã ã¨æ€’ã‚Šã¾ã™ã€‚çŸ­ãè‹±èªã§1æ–‡ã§è¿”ç­”ã—ã€æœ€å¾Œã«ã€Œæ—¥æœ¬èªè¨³ï¼šã€œã€œã€ã¨ã¤ã‘ã¦ã€‚: ${userText}`;
                
                const result = await model.generateContent(prompt);
                const response = await result.response;
                const text = response.text();

                // è‹±èªã¨æ—¥æœ¬èªã‚’åˆ†ã‘ã‚‹
                const parts = text.split('æ—¥æœ¬èªè¨³ï¼š');
                const english = parts[0].trim();
                const japanese = parts[1] ? parts[1].trim() : "";

                alexText.innerText = english;
                translationDiv.innerText = japanese;

                // å£°ã§å–‹ã‚‰ã›ã‚‹
                const uttr = new SpeechSynthesisUtterance(english);
                uttr.lang = 'en-US';
                uttr.rate = 0.9; // å°‘ã—ã‚†ã£ãã‚Šã€å¨åœ§çš„ã«
                window.speechSynthesis.speak(uttr);

            } catch (e) {
                console.error(e);
                alexText.innerText = "Error...";
                translationDiv.innerText = "ã¾ã ã‚­ãƒ¼ãŒåæ˜ ã•ã‚Œã¦ãªã„ã‹ã€é€šä¿¡ã‚¨ãƒ©ãƒ¼ã ã€‚";
            }
        };
    </script>
</body>
</html>
