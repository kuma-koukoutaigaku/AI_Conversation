<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>脱・Sorry！AIロールプレイング</title>
    <style>
        body { font-family: sans-serif; background: #f4f4f9; display: flex; justify-content: center; padding: 20px; }
        #chat-container { width: 100%; max-width: 500px; background: white; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); overflow: hidden; }
        #chat-box { height: 400px; overflow-y: auto; padding: 20px; border-bottom: 1px solid #ddd; display: flex; flex-direction: column; }
        .message { margin-bottom: 15px; line-height: 1.5; padding: 10px; border-radius: 8px; max-width: 80%; }
        .alex { background: #ffebee; color: #d32f2f; align-self: flex-start; border: 1px solid #ffcdd2; }
        .user { background: #e3f2fd; color: #1976d2; align-self: flex-end; border: 1px solid #bbdefb; }
        .input-area { display: flex; padding: 10px; }
        input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; outline: none; }
        button { padding: 10px 20px; background: #333; color: white; border: none; border-radius: 5px; margin-left: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div id="chat-container">
    <div style="background: #333; color: white; padding: 15px; text-align: center; font-weight: bold;">
        VS Alex (厳しい上司)
    </div>
    <div id="chat-box">
        <div class="message alex">Alex: Hey, I've been waiting for that updated report for over an hour. What's the hold-up?</div>
    </div>
    <div class="input-area">
        <input type="text" id="user-input" placeholder="Sorryを使わずに返信..." onkeypress="if(event.key==='Enter') sendMessage()">
        <button onclick="sendMessage()">送信</button>
    </div>
</div>

<script>
    // 君のキーをあらかじめ入れておいたよ
    const API_KEY = 'AIzaSyCvPaPcBQRsUi-kWyVTMcRwkkmQ6xPOzZI';

    async function sendMessage() {
        const inputField = document.getElementById('user-input');
        const userText = inputField.value;
        if (!userText) return;

        appendMessage('You', userText, 'user');
        inputField.value = '';

        try {
            // エラーが出にくい「最新の住所（URL）」に書き換えたよ
            const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [{ text: `あなたは厳しい上司Alexです。
                        ユーザーの今の発言: "${userText}"
                        状況: ユーザーは仕事が遅れているとあなたに怒られています。
                        練習フレーズ: My bad. / Thanks for waiting. / Noted. / No biggie. / Let me check.
                        
                        ルール: 
                        1. 英語で1〜2文、少し厳しく返信。
                        2. "Sorry" は禁止。使ったら怒る。
                        3. 最後に日本語で1行アドバイス。` }]
                    }]
                })
            });

            const data = await response.json();
            
            // AIからの返答を画面に出す処理
            if (data.candidates && data.candidates[0].content) {
                const alexReply = data.candidates[0].content.parts[0].text;
                appendMessage('Alex', alexReply, 'alex');
            } else {
                appendMessage('Alex', 'エラー：AIがうまく返事できなかったみたい。', 'alex');
            }
        } catch (error) {
            appendMessage('Error', '接続に失敗。ネットかキーの問題かも。', 'alex');
        }
    }

    function appendMessage(sender, text, className) {
        const div = document.createElement('div');
        div.className = `message ${className}`;
        div.innerHTML = `<strong>${sender}:</strong><br>${text}`;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }
</script>

</body>
</html>
