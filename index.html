<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VS Alex - ÊúÄÁµÇÊ±∫Êà¶</title>
    <style>
        body { margin: 0; font-family: sans-serif; height: 100vh; display: flex; align-items: center; justify-content: center;
               background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1497366216548-37526070297c?auto=format&fit=crop&w=1200&q=80');
               background-size: cover; background-position: center; color: white; }
        #app-container { width: 90%; max-width: 500px; text-align: center; background: rgba(0,0,0,0.8); padding: 40px; border-radius: 30px; border: 1px solid #444; }
        #alex-message { font-size: 1.5rem; font-weight: bold; margin-bottom: 10px; min-height: 60px; color: #fff; }
        #translation { font-size: 1rem; color: #aaa; margin-bottom: 30px; min-height: 20px; }
        .mic-btn { width: 90px; height: 90px; border-radius: 50%; border: none; background: #d32f2f; color: white; font-size: 2rem; cursor: pointer; transition: 0.3s; }
        .mic-btn.listening { background: #4caf50; box-shadow: 0 0 20px #4caf50; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        #user-speech { margin-top: 20px; color: #03a9f4; font-size: 0.9rem; }
    </style>
</head>
<body>

<div id="app-container">
    <div id="alex-message">Wait... checking connection...</div>
    <div id="translation"></div>
    <button id="mic-btn" class="mic-btn">üé§</button>
    <div id="user-speech"></div>
</div>

<script>
    // „Åì„Åì„ÇíÊúÄÊñ∞„ÅÆÊ≠£„Åó„ÅÑ„É¢„Éá„É´Âêç„Å´‰øÆÊ≠£„Åó„Åü„ÇàÔºÅ
    const API_KEY = 'AIzaSyBxOpLgJlbu5_uRTBhZL1gLdv1AjyNgkOI';
    const MODEL_NAME = 'gemini-1.5-flash-latest'; // „Åì„Åì„Åå‰øÆÊ≠£„Éù„Ç§„É≥„Éà

    const micBtn = document.getElementById('mic-btn');
    const alexMessage = document.getElementById('alex-message');
    const translationDiv = document.getElementById('translation');
    const userSpeechDiv = document.getElementById('user-speech');

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.lang = 'en-US';

    micBtn.onclick = () => {
        recognition.start();
        micBtn.classList.add('listening');
        userSpeechDiv.innerText = "Listening...";
    };

    recognition.onresult = (event) => {
        micBtn.classList.remove('listening');
        const transcript = event.results[0][0].transcript;
        userSpeechDiv.innerText = "You: " + transcript;
        chatWithAlex(transcript);
    };

    async function chatWithAlex(text) {
        alexMessage.innerText = "Alex is typing...";
        
        try {
            // URL„ÇíÊúÄÊñ∞„ÅÆÊ≠£ÂºèÁâà„Å´Â§âÊõ¥
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${API_KEY}`;
            
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: `„ÅÇ„Å™„Åü„ÅØÂé≥„Åó„ÅÑ‰∏äÂè∏Alex„Åß„Åô„ÄÇËã±Ë™û„Åß1„Äú2Êñá„ÄÅÂé≥„Åó„ÅèÁü≠„ÅèËøîÁ≠î„Åó„ÄÅÊúÄÂæå„Å´ÂøÖ„Åö„ÄåÊó•Êú¨Ë™ûË®≥Ôºö„Äú„Äú„Äç„Å®„Å§„Åë„Å¶„ÄÇ "${text}"` }] }]
                })
            });

            const data = await response.json();
            const fullReply = data.candidates[0].content.parts[0].text;
            
            const parts = fullReply.split('Êó•Êú¨Ë™ûË®≥Ôºö');
            const english = parts[0].trim();
            const japanese = parts[1] ? parts[1].trim() : "";

            alexMessage.innerText = english;
            translationDiv.innerText = japanese;

            // Èü≥Ë™≠
            const uttr = new SpeechSynthesisUtterance(english);
            uttr.lang = 'en-US';
            speechSynthesis.speak(uttr);

        } catch (e) {
            alexMessage.innerText = "„Åæ„Å†„Ç®„É©„Éº„ÅåÂá∫„Çã„Å≠„ÄÇGoogleÂÅ¥„ÅÆÂèçÊò†ÂæÖ„Å°„Åã„ÇÇ„ÄÇ";
            console.error(e);
        }
    }

    // Ëµ∑ÂãïÊôÇ„Å´‰∏ÄÁû¨Âñã„Çâ„Åõ„Å¶„Åø„Çã
    window.onload = () => { alexMessage.innerText = "Talk to me. Now."; translationDiv.innerText = "Ë©±„Åõ„ÄÅ‰ªä„Åô„Åê„Å†„ÄÇ"; };
</script>

</body>
</html>
